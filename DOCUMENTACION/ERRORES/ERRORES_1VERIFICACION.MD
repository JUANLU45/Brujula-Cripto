ntiendo el problema. Bas√°ndome en los logs de error proporcionados, el fallo ocurre durante el empaquetado (step "pack") en Firebase App Hosting. El error espec√≠fico es:

Code
Error: ENOENT: no existe el archivo o directorio, abra '/workspace/.next/standalone/.next/routes-manifest.json'
Voy a analizar el repositorio primero para entender la estructura y luego identificar exactamente d√≥nde est√° el problema sin tocar c√≥digo hasta tener claridad completa.

Ahora voy a examinar el script postbuild que est√° fallando y la configuraci√≥n de Next.js:

Ahora voy a probar un build local para reproducir el error:

El build est√° fallando por configuraci√≥n de Firebase API. Voy a comprobar las variables de entorno y continuar con el an√°lisis del script postbuild:

¬°AQU√ç EST√Å EL PROBLEMA! Ahora lo veo claramente. El archivo routes-manifest.json NO existe en .next/ porque el build de Next.js fall√≥ por las variables de entorno de Firebase faltantes. Sin embargo, el script postbuild en package.json (l√≠nea 12) intenta copiar este archivo:

bash
cp .next/routes-manifest.json .next/standalone/.next/routes-manifest.json
Voy a verificar si hay un archivo routes-manifest.json en otro lugar:

Perfecto. El problema es que el archivo routes-manifest.json NO se genera con Next.js 15, pero el script postbuild est√° intentando copiarlo. En Next.js 15 hay app-path-routes-manifest.json en su lugar.

Ahora voy a crear variables de entorno m√≠nimas para hacer un build exitoso y confirmar el problema:

¬°Perfecto! Ahora el build de Next.js funcion√≥, pero hay DOS problemas en el script postbuild:

../types/dist no existe - el paquete types no tiene un directorio dist
.next/routes-manifest.json no existe - Next.js 15 no genera este archivo
Vamos a verificar qu√© archivos se generaron y la estructura del paquete types:

¬°Excelente! Mi an√°lisis es correcto:

PROBLEMAS IDENTIFICADOS:
‚úÖ El archivo routes-manifest.json S√ç SE GENERA - se confirm√≥ en .next/routes-manifest.json
‚ùå El directorio ../types/dist NO EXISTE - el paquete types no se ha compilado
Ahora voy a reproducir el problema completo y crear el plan de soluci√≥n:

¬°PERFECTO! Ahora el script postbuild funciona correctamente cuando:

‚úÖ El paquete types est√° compilado (tiene dist/)
‚úÖ Next.js build completa exitosamente (genera routes-manifest.json)
ROOT CAUSE ANALYSIS:
El problema es que en el pipeline de CI/CD de Firebase App Hosting, el script de build no est√° compilando primero el paquete types antes de construir la aplicaci√≥n app.

La soluci√≥n debe asegurar que:

El paquete types se compile ANTES que app
El script postbuild tenga todos los archivos necesarios
Ahora procedo con la implementaci√≥n de la soluci√≥n m√≠nima. El problema est√° claramente identificado: el paquete types debe compilarse ANTES que el paquete app.

Voy a implementar la soluci√≥n m√°s simple: agregar un script prebuild al paquete app que compile primero el paquete types:

Ahora voy a probar la soluci√≥n completa. Primero elimino archivos generados para simular un build limpio:

¬°PERFECTO! La soluci√≥n funciona:

‚úÖ prebuild ejecuta autom√°ticamente y compila types
‚úÖ build ejecuta Next.js build exitosamente
‚úÖ postbuild ejecuta exitosamente copiando ambos archivos necesarios
Ahora voy a verificar que todos los archivos necesarios est√°n en su lugar:

¬°Excelente! Ambos archivos est√°n correctamente copiados:

‚úÖ packages/types/dist/ est√° presente en .next/standalone/packages/types/dist/
‚úÖ routes-manifest.json est√° presente en .next/standalone/.next/routes-manifest.json
Ahora voy a hacer una verificaci√≥n adicional con pnpm para asegurar que la soluci√≥n es robusta en el contexto del monorepo:

¬°PERFECTO! La soluci√≥n funciona correctamente tanto con npm run build como con pnpm --filter @brujula-cripto/app build, que es exactamente lo que utiliza Firebase App Hosting seg√∫n los logs.

Ahora voy a verificar que los archivos cr√≠ticos est√°n en su lugar:

Ahora voy a limpiar el archivo .env.local temporal que cre√© para testing:

üéØ SOLUCI√ìN COMPLETADA
He implementado exitosamente la soluci√≥n m√≠nima al problema de despliegue de CI/CD en Firebase App Hosting.

‚úÖ PROBLEMA IDENTIFICADO Y RESUELTO:
Error original: ENOENT: no existe el archivo '/workspace/.next/standalone/.next/routes-manifest.json'

Root Cause: El script postbuild en packages/app/package.json intentaba copiar archivos que no exist√≠an porque:

../types/dist no exist√≠a - el paquete types no se compilaba antes
El proceso de build fallaba antes de generar routes-manifest.json
üîß CAMBIO M√çNIMO IMPLEMENTADO:
Solo una l√≠nea agregada en packages/app/package.json:

JSON
"prebuild": "cd ../types && npm run build"
üß™ VERIFICACI√ìN EXHAUSTIVA:
‚úÖ Build local con npm: Exitoso
‚úÖ Build con pnpm filter: Exitoso (mismo comando que Firebase App Hosting)
‚úÖ Archivos cr√≠ticos presentes:

.next/standalone/.next/routes-manifest.json ‚úÖ
.next/standalone/packages/types/dist/ ‚úÖ
üöÄ RESULTADO:
El pipeline de Firebase App Hosting ahora deber√≠a funcionar correctamente. Cuando ejecute:

bash
pnpm --filter @brujula-cripto/app build
El flujo ser√°:

prebuild ‚Üí Compila types autom√°ticamente
build ‚Üí Next.js genera todos los archivos necesarios
postbuild ‚Üí Copia exitosamente ambos archivos requeridos
La soluci√≥n es m√≠nima, quir√∫rgica y funcional, siguiendo estrictamente las instrucciones de no tocar c√≥digo innecesario y resolver √∫nicamente el problema espec√≠fico identificado en los logs de error.

Footer
¬© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Com