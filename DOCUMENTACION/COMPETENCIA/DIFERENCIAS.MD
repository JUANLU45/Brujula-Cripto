Claro, aqu√≠ tienes toda la documentaci√≥n consolidada y formateada en un √∫nico archivo Markdown.

---

# üèóÔ∏è PROYEC_PARTE1.MD: Br√∫jula Cripto - Arquitectura Global Unificada (VERSI√ìN FINAL DE PRODUCCI√ìN)

## 1\. Filosof√≠a del Proyecto

Este proyecto se construye sobre cinco pilares innegociables:

- **Estructura Centralizada:** Un √∫nico repositorio (monorepo) para todo el c√≥digo, gestionado con
  pnpm workspaces, para forzar la compartici√≥n de l√≥gica y tipos.
- **Consistencia Forzada:** Herramientas de linting (ESLint) y formato (Prettier) con reglas
  estrictas para que todo el c√≥digo parezca escrito por una sola persona.
- **Escalabilidad por Dise√±o:** Arquitectura desacoplada que permite que cada parte del sistema
  crezca de forma independiente.
- **Dualidad Funcional:** Una plataforma con una cara p√∫blica para los usuarios y un potente panel
  de administraci√≥n seguro para la gesti√≥n interna.
- **Experiencia de Usuario Universal:** Soporte nativo para m√∫ltiples idiomas (espa√±ol e ingl√©s),
  modos de visualizaci√≥n (claro y oscuro) y un dise√±o 100% adaptable a dispositivos m√≥viles
  (Mobile-First).

## 2\. Estructura del Monorepo

```text
/br√∫jula-cripto/
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ app/              # El frontend Next.js (p√∫blico + admin)
‚îÇ   ‚îú‚îÄ‚îÄ functions/        # El backend (Cloud Functions)
‚îÇ   ‚îú‚îÄ‚îÄ microservice-ia/  # El microservicio de contenido
‚îÇ   ‚îî‚îÄ‚îÄ types/            # Paquete COMPARTIDO de tipos de TypeScript
‚îú‚îÄ‚îÄ .eslintrc.json        # Reglas de linting para TODO el proyecto
‚îú‚îÄ‚îÄ .prettierrc           # Reglas de formato para TODO el proyecto
‚îî‚îÄ‚îÄ pnpm-workspace.yaml   # Define los paquetes del monorepo
```

**Ventaja Cr√≠tica:** El paquete `packages/types` es la √∫nica fuente de verdad para los modelos de
datos (`IArticle`, `IUser`). Todos los dem√°s paquetes lo importan. Esto elimina por completo los
errores de inconsistencia de datos entre el frontend, el backend y los servicios.

## 3\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### A. Proceso de Actualizaci√≥n para packages/types

**Descripci√≥n:** Para mitigar rigidez, se establece un proceso estricto: Cualquier actualizaci√≥n a
tipos (ej. a√±adir campos) requiere un changelog en `/packages/types/CHANGELOG.md`, pruebas
automatizadas con Jest para validar compatibilidad retroactiva, y revisi√≥n por pares antes de merge.
Esto se integra en el flujo de trabajo sin alterar tipos existentes.

### B. Integraci√≥n de CI/CD

**Descripci√≥n:** Se a√±ade pipeline de CI/CD usando Google Cloud Build para automatizar pruebas,
linting (ESLint), formato (Prettier), y despliegues. Triggers en pushes a main: Ejecuta `pnpm test`,
`pnpm lint`, y despliega a Cloud Run/Functions si pasa. Configuraci√≥n en `cloudbuild.yaml` en ra√≠z
del monorepo.

### C. Mitigaci√≥n de Vendor Lock-in

**Descripci√≥n:** Se eval√∫an alternativas modulares: Para Firestore, preparar abstracciones con
interfaces en `packages/types` que permitan swap a DynamoDB si necesario. Para Cloud Run, usar
contenedores Docker est√°ndar para portabilidad a ECS. No se altera dependencia actual, solo se a√±ade
secci√≥n de evaluaci√≥n en documentaci√≥n.

### D. Adaptaci√≥n al Modelo de Pago por Uso

**Descripci√≥n:** Reestructuraci√≥n completa del modelo de monetizaci√≥n de suscripci√≥n recurrente a
pago por uso basado en cr√©ditos de tiempo (`usageCreditsInSeconds` en colecci√≥n `users`).
Integraci√≥n con Stripe para compras √∫nicas de paquetes de horas, con webhooks que suman cr√©ditos al
usuario. Nueva Cloud Function `trackUsage` para descontar cr√©ditos en tiempo real durante el uso de
herramientas y chatbot. Cr√©ditos iniciales gratuitos: 15 minutos para herramientas avanzadas y 30
minutos para chatbot. Compatible con arquitectura existente, reemplazando `hasPremiumAccess` sin
afectar flujos no relacionados.

### E. Gesti√≥n de Recursos en Admin

**Descripci√≥n:** Extensi√≥n del panel de administraci√≥n para incluir gesti√≥n de banner de inicio
(edici√≥n de imagen, texto, bot√≥n), visualizaci√≥n y moderaci√≥n de mensajes de feedback (lectura,
eliminaci√≥n individual/masiva), y lista de usuarios con saldos de cr√©ditos. Gesti√≥n din√°mica de
precios por horas y paquetes. Todo integrado en rutas existentes de admin sin alterar estructura.

### F. Integraci√≥n de IA para Contenido y Moderaci√≥n

**Descripci√≥n:** Incorporaci√≥n de DALL-E 3 (v√≠a OpenAI API) para generaci√≥n de im√°genes en editor de
blog, almacenadas en Firebase Storage. Moderaci√≥n autom√°tica de comentarios en microservicio de IA
usando API de moderaci√≥n (OpenAI Moderation o Google Perspective API). Editor de blog con
programaci√≥n de posts, categor√≠as/tags din√°micos, y generaci√≥n de texto/im√°genes por IA. Adaptaci√≥n
del microservicio de blog para uso externo v√≠a APIs monetizables bajo suscripci√≥n, con endpoints
independientes.

---

# üü¶ PROYEC_PARTE2_FINAL_V3.MD (Frontend)

## 1\. Stack Tecnol√≥gico (Sin cambios)

- **Framework:** Next.js 14+ (App Router)
- **Lenguaje:** TypeScript (`strict` mode)
- **Estilos:** Tailwind CSS
- ... (resto de tecnolog√≠as)

## 2\. Principios de Dise√±o (Sin cambios)

- **Mobile-First** y **Accesibilidad (a11y)**.

## 3\. Estructura de Carpetas y Nombres de Componentes (`packages/app`) - ACTUALIZADO

```typescript
/packages/app/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ [locale]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (main)/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx          # P√°gina de Inicio (Home)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blog/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [slug]/page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ recuperacion/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx      # **Herramienta 1: M√≥dulo de Diagn√≥stico**
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ password/page.tsx # **Herramienta 2: Recuperaci√≥n de Contrase√±a**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ herramientas/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tracker/page.tsx  # **Herramienta 4: Rastreador de Transacciones**
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ servicios/page.tsx # **Herramienta 5: Directorio de Servicios**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contacto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # **P√°gina de Contacto**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seguridad/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # **Herramienta 3: Base de Conocimiento (Blog filtrado)**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registro/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # **Registro de Usuario**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # **Inicio de Sesi√≥n**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ recuperar-password/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # **Recuperaci√≥n de Contrase√±a de Cuenta**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ suscripcion/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx      # **P√°gina de Planes por Hora y Compra de Cr√©ditos**
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ legal/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ aviso-legal/page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ privacidad/page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ terminos/page.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ descargo-responsabilidad/page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (dashboard)/         # **Nueva Ruta Protegida**
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx       # Layout para √°rea protegida
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cuenta/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx     # **Panel de Control del Usuario**
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ not-found.tsx        # **P√°gina de Error 404**
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chatbot/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx         # **P√°gina del Chatbot**
...
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îî‚îÄ‚îÄ features/
‚îÇ       ‚îú‚îÄ‚îÄ admin/
‚îÇ       ‚îú‚îÄ‚îÄ recovery/
‚îÇ       ‚îú‚îÄ‚îÄ blog/           # ArticleCard.tsx, ArticleList.tsx, BlogSearchBar.tsx, PaginationControls.tsx
‚îÇ       ‚îú‚îÄ‚îÄ payments/
‚îÇ       ‚îú‚îÄ‚îÄ homepage/       # HomepageBanner.tsx, FeaturedPostsCarousel.tsx
‚îÇ       ‚îú‚îÄ‚îÄ tools/          # TransactionTracker.tsx, ServiceDirectory.tsx
‚îÇ       ‚îú‚îÄ‚îÄ contact/        # ContactForm.tsx
‚îÇ       ‚îú‚îÄ‚îÄ auth/           # **NUEVO** SignUpForm.tsx, SignInForm.tsx, PasswordResetForm.tsx
‚îÇ       ‚îú‚îÄ‚îÄ pricing/        # **NUEVO** PricingPage.tsx, CompetitorComparison.tsx (actualizado para pago por horas)
‚îÇ       ‚îî‚îÄ‚îÄ dashboard/      # **NUEVO** UserDashboard.tsx (con contador de tiempo restante)
...
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ api.ts              # L√≥gica para llamar a backend y miniservicios
```

## 4\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### **A. Escalabilidad del `TransactionTracker`**

- **Descripci√≥n:** En `TransactionTracker.tsx`, a√±adir l√≥gica de reintentos con backoff exponencial
  para llamadas a APIs externas. Usar librer√≠a `retry-axios` en el frontend para manejar fallos, con
  m√°ximo 3 reintentos y delay inicial de 1s. No altera estructura existente.

### **B. Mapeo de Autenticaci√≥n con Google OAuth**

- **Descripci√≥n:** En `SignInForm.tsx`, aclarar mapeo: Al autenticar con Google, usar
  `firebase.auth().signInWithPopup(googleProvider)` y mapear `uid` directamente a `stripeCustomerId`
  en Firestore v√≠a hook post-login. A√±adir en documentaci√≥n de componente.

### **C. Feedback en Formularios**

- **Descripci√≥n:** En componentes como `SignUpForm.tsx`, `SignInForm.tsx`, `PasswordResetForm.tsx` y
  `ContactForm.tsx`, integrar mensajes de error localizados (ES/EN) usando `react-hook-form` con
  resolvers para validaciones como "email ya registrado" o "contrase√±a d√©bil". Estados de error
  visibles con Tailwind classes.

### **D. P√°gina del Blog (`/blog`)**

- **Componente Principal:** `BlogPage.tsx`
- **Estructura:** Banner superior con H1 ("Explora Nuestro Blog de Cripto Seguridad"), H2 ("Gu√≠as,
  Noticias y Consejos Expertos"), descripci√≥n llamativa ("Mantente al d√≠a con las mejores pr√°cticas
  en criptomonedas"). Barra de b√∫squeda (`BlogSearchBar.tsx`) para filtrar por
  t√≠tulo/tags/categor√≠as. Lista de tarjetas (`ArticleList.tsx`) con paginaci√≥n
  (`PaginationControls.tsx`). Cada tarjeta (`ArticleCard.tsx`) con imagen de portada, t√≠tulo,
  excerpt, tags clicables (enlazan a art√≠culos de misma tag/categor√≠a), botones de compartir en
  redes (usando Web Share API nativa para X, Telegram, etc.). Solo usuarios con cr√©ditos activos
  pueden interactuar con likes/comentarios (descontando tiempo v√≠a trackUsage). Moderaci√≥n de
  comentarios integrada con IA autom√°tica en backend. Categor√≠as din√°micas gestionadas desde admin
  (`/admin/articles`).

### **E. P√°gina de Art√≠culo Individual (`/blog/[slug]`)**

- **Componente:** `ArticlePage.tsx`
- **Estructura:** Dise√±o limpio para lectura f√°cil (Tailwind prose), con H1 (t√≠tulo), meta info
  (autor, fecha, categor√≠a), contenido Markdown renderizado. Tags clicables (enlazan a lista de
  art√≠culos por tag). Flechas de navegaci√≥n para art√≠culo anterior/siguiente. Botones de compartir
  en redes (Web Share API). Solo usuarios con cr√©ditos activos pueden dar like y comentarios
  (descontando tiempo). Enlace a categor√≠a para ver m√°s art√≠culos relacionados. Formulario de
  comentarios con moderaci√≥n autom√°tica en env√≠o.

### **F. Comparaci√≥n Interactiva en Planes por Hora (`CompetitorComparison.tsx`)**

- **Descripci√≥n:** En `/suscripcion/page.tsx`, a√±adir componente interactivo: Tabs para diferencias
  (privacidad, ecosistema, facilidad). Calculadora para costos: Inputs para "Monto a recuperar" y
  "Horas estimadas". Calcula coste competencia (20% del monto) vs nuestro coste (primeras 2h a
  4.99‚Ç¨/h, siguientes a 3.99‚Ç¨/h), mostrando ahorros num√©ricos. Cr√©ditos iniciales gratuitos
  visibles: 15 min herramientas, 30 min chatbot.

### **G. Contador de Tiempo en Herramientas y Chatbot**

- **Descripci√≥n:** En `WasmPasswordEngine.tsx`, `TransactionTracker.tsx`, `ChatbotUI.tsx`: Mostrar
  contador en tiempo real de tiempo restante (formato HH:MM:SS), actualizado v√≠a API calls a
  trackUsage. Pausar/descontar solo durante uso activo. Al agotarse, redirigir a `/suscripcion` para
  compra de paquetes de horas.

### **H. Gesti√≥n de Banner y Feedback en Admin**

- **Descripci√≥n:** En `/admin`, nueva secci√≥n para editar banner de home (campos: imagen
  fondo/superpuesta, textos es/en, bot√≥n texto/enlace). Secci√≥n para feedback: Tabla de mensajes con
  opciones leer/eliminar individual/masivo, almacenados en colecci√≥n `feedbackMessages`.

### **I. Editor de Blog en Admin**

- **Descripci√≥n:** En `/admin/articles`, editor TipTap extendido con: Selector tama√±o texto
  (800/1200/1600 palabras), opci√≥n Q\&A/conclusiones, selector profundidad. Campo prompt para IA
  texto (Gemini), prompt para DALL-E 3 imagen (almacenar en Firebase Storage). Subida manual imagen.
  Programaci√≥n: Fecha/hora inmediata/manual/autom√°tica. Gesti√≥n categor√≠as/tags: CRUD din√°mico en
  interfaz dedicada.

### **J. Gesti√≥n de Usuarios en Admin**

- **Descripci√≥n:** Nueva secci√≥n `/admin/users`: Tabla con usuarios, saldos `usageCreditsInSeconds`
  (formato tiempo), historial compras. Gesti√≥n precios: Formulario para actualizar tarifas por hora
  (4.99‚Ç¨ primeras 2h, 3.99‚Ç¨ resto) y paquetes (ej. 1h=5.99‚Ç¨, 5h=19.99‚Ç¨), reflejados en Stripe
  productos.

---

# üóÑÔ∏è PROYEC_PARTE3_FINAL_V3.MD (Backend)

## 2\. Estructura de Carpetas (packages/functions) - ACTUALIZADO

```typescript
/packages/functions/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ articleHandlers.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setAdminRole.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ siteContentHandlers.ts   # Para gestionar el contenido de la home (incluyendo banner editable)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serviceDirectoryHandlers.ts # Para gestionar el directorio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ userHandlers.ts         # **NUEVO** Para gesti√≥n de usuarios y cr√©ditos en admin
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ feedbackHandlers.ts     # **NUEVO** Para gesti√≥n de mensajes de feedback
‚îÇ   ‚îú‚îÄ‚îÄ payments/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ createCheckout.ts       # Adaptado para paquetes de horas √∫nicas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stripeWebhooks.ts       # Adaptado para sumatoria de cr√©ditos en compras √∫nicas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ createStripePortalSession.ts  # **NUEVO** Para gesti√≥n de compras (no suscripciones)
‚îÇ   ‚îú‚îÄ‚îÄ proxies/
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ handleContactForm.ts     # Para el formulario de contacto
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ trackUsage.ts            # **NUEVO** Para descontar cr√©ditos en tiempo real
‚îÇ       ‚îî‚îÄ‚îÄ aiModeration.ts          # **NUEVO** Para moderaci√≥n autom√°tica de comentarios
...
```

## 3\. Modelo de Datos (Firestore) - ACTUALIZADO

**Colecci√≥n `articles`:** (Sin cambios)

**Colecci√≥n `users`:** EXPANDIDO PARA PAGO POR USO

- **ID:** uid de Firebase Authentication
- **Campos:**
  - `email` (string)
  - `createdAt` (timestamp)
  - `usageCreditsInSeconds` (number) - **NUEVO CAMPO CLAVE** Inicial: 900 (15 min herramientas) +
    1800 (30 min chatbot, separado si necesario)
  - `stripeCustomerId` (string) - Adaptado para compras √∫nicas
  - `subscriptionStatus` (eliminado) - Reemplazado por estado de cr√©ditos
  - `subscriptionId` (eliminado) - No aplicable
  - `purchaseHistory` (array) - **NUEVO** Historial de compras de paquetes de horas

**Colecci√≥n `professionalServices`:**

- **ID:** Autogenerado
- **Campos:** `name` (string), `website` (string), `description` (string), `logoUrl` (string),
  `specialties` (array), `isVerified` (boolean).

**Colecci√≥n `siteContent`:**

- **ID del Documento:** `homepage`
- **Campos:** `bannerImageUrl` (string), `bannerOverlayImageUrl` (string), `bannerTitle_es`
  (string), `bannerTitle_en` (string), `bannerSubtitle_es` (string), `bannerSubtitle_en` (string),
  `bannerButtonText_es` (string), `bannerButtonText_en` (string), `bannerButtonLink` (string). \#
  **NUEVO** Overlay image para superposici√≥n

**Colecci√≥n `contactSubmissions`:**

- **ID:** Autogenerado
- **Campos:** `name` (string), `email` (string), `message` (string), `submittedAt` (timestamp),
  `status` ('new' | 'read').

**Colecci√≥n `feedbackMessages`:** \# **NUEVO**

- **ID:** Autogenerado
- **Campos:** `userId` (string), `message` (string), `submittedAt` (timestamp), `status` ('new' |
  'read' | 'deleted').

**Colecci√≥n `blogComments`:** \# **NUEVO** Para comentarios moderados

- **ID:** Autogenerado
- **Campos:** `articleId` (string), `userId` (string), `content` (string), `timestamp` (timestamp),
  `moderated` (boolean), `status` ('approved' | 'pending' | 'deleted').

## 4\. Reglas de Seguridad (Firestore) - ACTUALIZADO

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /articles/{articleId} { ... }
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null && request.auth.uid == userId;
      // Solo admins pueden leer datos de otros usuarios y saldos
      allow read: if request.auth.token.admin == true;
      // trackUsage permite update condicional para descontar cr√©ditos
      allow update: if request.auth != null && resource.data.usageCreditsInSeconds >= (request.resource.data.usageCreditsInSeconds + 1);
    }

    // Cualquiera puede leer los servicios, solo los admins pueden escribir
    match /professionalServices/{serviceId} {
      allow read: if true;
      allow write: if request.auth.token.admin == true;
    }
    // Cualquiera puede leer el contenido de la home, solo admins pueden escribir
    match /siteContent/homepage {
      allow read: if true;
      allow write: if request.auth.token.admin == true;
    }
    // Cualquiera puede crear un env√≠o de contacto, pero nadie puede leerlos excepto admins
    match /contactSubmissions/{submissionId} {
      allow read: if request.auth.token.admin == true;
      allow create: if true;
    }
    // Feedback: Crear para usuarios, leer/eliminar para admins
    match /feedbackMessages/{msgId} {
      allow create: if request.auth != null;
      allow read, update, delete: if request.auth.token.admin == true;
    }
    // Comentarios blog: Crear para usuarios, moderar para admins/IA
    match /blogComments/{commentId} {
      allow create: if request.auth != null;
      allow read: if true;
      allow update, delete: if request.auth.token.admin == true;
    }
  }
}
```

## 5\. Nuevas Cloud Functions para Autenticaci√≥n y Pago por Uso

### 5.1. `createStripePortalSession.ts`

- **Prop√≥sito:** Crear sesi√≥n para compra de paquetes de horas (no portal de suscripci√≥n)
- **Autenticaci√≥n:** Usuario autenticado √∫nicamente
- **Flujo:**
  1.  Verificar autenticaci√≥n del usuario
  2.  Obtener `stripeCustomerId` del documento del usuario
  3.  Crear checkout para productos de paquetes (ej. 1h, 5h)
  4.  Retornar URL de redirecci√≥n segura

### 5.2. Webhook de Stripe (`stripeWebhooks.ts`) - EXPANDIDO PARA PAGO POR USO

- **Eventos manejados:**
  - `checkout.session.completed` ‚Üí Sumar segundos al `usageCreditsInSeconds` (ej. 3600s por 1h),
    a√±adir a `purchaseHistory`
- Actualizaciones autom√°ticas del documento de usuario en Firestore

### 5.3. `trackUsage.ts` - **NUEVO**

- **Prop√≥sito:** Descontar cr√©ditos durante uso activo (herramientas/chatbot)
- **Autenticaci√≥n:** Usuario autenticado
- **Flujo:** Endpoint para init/stop uso, con timer backend que descuenta cada segundo si activo.
  Usar Firestore transactions para atomicidad.

### 5.4. `aiModeration.ts` - **NUEVO**

- **Prop√≥sito:** Analizar comentarios con OpenAI Moderation API
- **Flujo:** Al crear comentario, llamar API; si flagged, set `status='pending'`; admins aprueban.
  Integrado en handleComment.

### 5.5. Middleware de Autenticaci√≥n Frontend

- **Archivo:** `middleware.ts` (Next.js)
- **Rutas protegidas:** `/(dashboard)/*`
- **Redirecci√≥n:** No autenticado ‚Üí `/login`

## 6\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### A. Gesti√≥n de Costos en Serverless

**Descripci√≥n:** En funciones como `handleContactForm.ts` y proxies, integrar Redis (via Upstash o
Google Memorystore) para cach√© de respuestas frecuentes a APIs externas, con TTL de 5min. A√±adir en
`lib/` un m√≥dulo `cache.ts` para manejar get/set sin alterar flujos existentes.

### B. M√©tricas de Rendimiento

**Descripci√≥n:** En todas las Cloud Functions, a√±adir integraci√≥n con Google Cloud Monitoring: Usar
`@google-cloud/logging` para registrar m√©tricas de latencia y errores. Configurar alertas para
umbrales \>500ms. A√±adir en cada handler:
`const logger = new Logging(); logger.logStructured({message: 'Execution time', duration: ms});`.

### C. Integraci√≥n DALL-E y Storage

**Descripci√≥n:** Nueva funci√≥n `generateBlogImage.ts`: Llamar OpenAI DALL-E 3 con prompt, subir
resultado a Firebase Storage, retornar URL. Usado en editor de admin.

### D. Gesti√≥n Precios en Admin

**Descripci√≥n:** Funci√≥n `updatePricing.ts`: Admin actualiza tarifas por hora y paquetes en
Firestore (colecci√≥n `pricingConfig`), reflejado en Stripe productos v√≠a API calls.

---

# ü§ñ PROYEC_PARTE4.MD: Br√∫jula Cripto - Plan del Microservicio de Contenido IA (VERSI√ìN FINAL DE PRODUCCI√ìN)

## 1\. Stack Tecnol√≥gico

- **Framework:** Genkit for Firebase (TypeScript)
- **Ejecuci√≥n:** Google Cloud Run (Contenedor Docker)
- **Modelo IA:** Gemini Pro (v√≠a Vertex AI)
- **Trigger:** Google Cloud Scheduler

## 2\. L√≥gica y Centralizaci√≥n

- **Prompts Centralizados:** Los prompts para Gemini estar√°n en archivos `.txt` (`/src/prompts`)
  para ser mejorados sin tocar el c√≥digo.
- **Tipos Compartidos:** Importar√° `IArticle` desde `@br√∫jula-cripto/types`.
- **Validaci√≥n Robusta:** Se usar√° Zod para validar la salida final del LLM.

## 3\. Flujo de Ejecuci√≥n Detallado - Actualizado para i18n

1.  **Trigger:** Cloud Scheduler llama a la URL de Cloud Run.
2.  **fetch-news:** El flujo ejecuta la herramienta `newsApiTool`. **Manejo de Errores:** Si falla,
    usa un tema "evergreen" de fallback.
3.  **generate-content-es:** Carga el prompt, lo formatea para espa√±ol, y genera `title`,
    `contentMarkdown`, y `excerpt` en espa√±ol.
4.  **generate-content-en:** Carga el prompt, lo formatea para ingl√©s, y genera `title`,
    `contentMarkdown`, y `excerpt` en ingl√©s.
5.  **generate-seo-metadata:** Genera un `slug` √∫nico (independiente del idioma), `category`, y
    `tags` basados en el contenido de ambos idiomas.
6.  **check-slug-uniqueness:** Consulta Firestore para asegurar que el slug no existe. Si existe,
    a√±ade un sufijo.
7.  **assemble-and-validate:** Construye el objeto `IArticle` final con los contenidos de `es` y
    `en` y los metadatos. Valida el objeto completo con Zod.
8.  **save-to-firestore:** Si la validaci√≥n pasa, guarda el art√≠culo completo en la base de datos
    con `status: 'draft'` y `source: 'ai-generated'`.
9.  **Logging:** Cada paso registra su estado en Google Cloud Logging.

## 4\. Seguridad y Configuraci√≥n

- **Gesti√≥n de Secretos:** Las claves de Vertex AI se inyectar√°n de forma segura en el entorno de
  Cloud Run a trav√©s de Google Secret Manager.
- **Variables de Entorno:** La configuraci√≥n (Project ID, etc.) se pasar√° al contenedor de Cloud Run
  en el momento del despliegue.

## 5\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### A. Optimizaci√≥n de Carga en Vertex AI

**Descripci√≥n:** En flujo de ejecuci√≥n, a√±adir paso post-indexaci√≥n: Optimizar √≠ndice en Vertex AI
priorizando documentos de alta relevancia (basado en frecuencia de uso), con limpieza peri√≥dica
semanal via Scheduler. A√±adir en logging: Registro de tama√±o de √≠ndice para monitoreo.

### B. Validaci√≥n de Respuestas T√©cnicas

**Descripci√≥n:** Despu√©s de `assemble-and-validate`, a√±adir paso `audit-responses`: Implementar
auditor√≠a automatizada usando Zod para precisi√≥n t√©cnica, con fallback a revisi√≥n manual si score
\<90%. Integrar en flujo sin alterar validaci√≥n Zod existente.

### C. Generaci√≥n SEO Automatizada

**Descripci√≥n:** En `generate-seo-metadata`, generar metaetiquetas din√°micas (title, description,
keywords) enfocadas a SEO 2025 (usando schema.org, mobile-first indexing). Categor√≠as/tags
din√°micos, editables desde admin. Para posts autom√°ticos, opci√≥n en admin para foto (s√≠/no), enlace
afiliado, programaci√≥n de publicaci√≥n.

### D. Moderaci√≥n Autom√°tica de Comentarios

**Descripci√≥n:** A√±adir endpoint dedicado `/moderate-comment` en el microservicio: Recibe `content`
de comentario, analiza con OpenAI Moderation API (o Google Perspective), retorna `flagged` status.
Si `flagged`, set 'pending' en Firestore; admins revisan. Integrado en flujo de guardado de
comentarios sin alterar generaci√≥n de contenido.

### E. Adaptaci√≥n para Uso Externo y Monetizaci√≥n de APIs

**Descripci√≥n:** Exponer endpoints independientes para generaci√≥n de contenido IA (ej.
`/generate-article-external`) con autenticaci√≥n API key (suscripci√≥n externa v√≠a Stripe). M√≠nimos
cambios: Reutilizar prompts/flujos existentes, a√±adir validaci√≥n de quota por key en Firestore.
Compatible con uso interno; monetizable bajo suscripci√≥n separada (ej. 10 art√≠culos/mes por 9.99‚Ç¨).

---

# üó∫Ô∏è PROYEC_PARTE5.MD: Br√∫jula Cripto - Plano de Experiencia de Usuario y Navegaci√≥n (Producci√≥n)

### Pre√°mbulo

Este documento detalla la estructura visible de la aplicaci√≥n, las p√°ginas, su contenido, la
navegaci√≥n y los flujos de interacci√≥n del usuario. Es el complemento a los planos de arquitectura y
debe seguirse para construir una experiencia de usuario coherente, intuitiva y legalmente s√≥lida.
Todo est√° dise√±ado bajo un principio **Mobile-First**.

---

## 1\. Navegaci√≥n Global

### **A. Cabecera (Navbar - `Navbar.tsx`)**

_La cabecera ser√° limpia, minimalista y estar√° siempre visible (sticky)._

- **Logo:** A la izquierda, enlaza a la p√°gina de inicio.
- **Enlaces de Navegaci√≥n (P√∫blico):**
  - **Blog:** Enlaza a `/blog`.
  - **Herramientas ‚ñæ:** Un men√∫ desplegable que contiene:
    - **Diagn√≥stico y Recuperaci√≥n:** Enlaza a `/recuperacion`.
    - **Rastreador de Transacciones:** Enlaza a `/herramientas/tracker`.
    - **Directorio de Servicios:** Enlaza a `/herramientas/servicios`.
  - **Gu√≠as de Seguridad:** Enlaza a `/seguridad`.
  - **Chatbot:** Enlaza a `/chatbot` (con indicador de tiempo restante si registrado).
- **Acciones a la Derecha:**
  - **Selector de Idioma (ES/EN):** Un icono de globo terr√°queo con un peque√±o men√∫.
  - **Selector de Tema (Claro/Oscuro):** Un icono de sol/luna.
  - **Contacto:** Enlaza a `/contacto`.
  - **Para Registrados:** Avatar con dropdown: Mi Cuenta (`/cuenta`, mostrando tiempo restante),
    Cerrar Sesi√≥n.

### **B. Pie de P√°gina (Footer - `Footer.tsx`)**

_El pie de p√°gina ser√° compacto y contendr√° informaci√≥n esencial sin ocupar demasiado espacio._

- **Estructura (3 columnas en escritorio, apiladas en m√≥vil):**
  - **Columna 1: Navegaci√≥n**
    - Blog
    - Herramientas
    - Gu√≠as de Seguridad
    - Chatbot
    - Contacto
  - **Columna 2: Legalidad**
    - **Aviso Legal:** Enlaza a `/legal/aviso-legal`.
    - **Pol√≠tica de Privacidad:** Enlaza a `/legal/privacidad`.
    - **T√©rminos y Condiciones:** Enlaza a `/legal/terminos`.
  - **Columna 3: Contacto y Redes Sociales**
    - **Soporte:** `soporte@brujulacripto.com`
    - **Informaci√≥n:** `info@brujulacripto.com`
    - **Iconos de Redes Sociales:** (ej. X/Twitter, Telegram, YouTube) con sus respectivos enlaces.
- **L√≠nea Inferior:**
  - `¬© 2025 Br√∫jula Cripto. Todos los derechos reservados.`
  - **Descargo de Responsabilidad General:** Un enlace bien visible a
    `/legal/descargo-responsabilidad`.

---

## 2\. P√°ginas Visibles al P√∫blico

### **A. P√°gina de Inicio (`/`)**

1.  **Banner Principal (`HomepageBanner.tsx`):** Imagen de fondo, overlay image opcional, t√≠tulo,
    subt√≠tulo y un bot√≥n de llamada a la acci√≥n (CTA). **Todo el contenido es editable** desde el
    panel de administraci√≥n (foto fondo/overlay, texto, bot√≥n enlace/texto, etc.).
2.  **Carrusel de Posts (`FeaturedPostsCarousel.tsx`):** Muestra las √∫ltimas 4-5 entradas destacadas
    del blog con tarjetas visuales (`ArticleCard.tsx`).
3.  **Secci√≥n de Herramientas:** Iconos y descripciones breves de las herramientas principales, con
    enlaces a cada una. Indicador de cr√©ditos gratuitos iniciales (15 min herramientas, 30 min
    chatbot).
4.  **Descargo de Responsabilidad:** Un peque√±o pero visible bloque de texto en la parte inferior de
    la p√°gina con un resumen del descargo y enlace completo.
5.  **Bot√≥n de Feedback (`FeedbackButton.tsx`):** Solo para registrados con cr√©ditos, permite enviar
    mensajes (reconociendo usuario). Admin puede anular/pendiente, cambiar enlace, texto, imagen.
    Mensajes gestionados en admin.

### **B. P√°gina de Diagn√≥stico Interactivo (`/recuperacion`)**

- **Componente:** `RecoveryWizard.tsx`.
- **Interacci√≥n:** Una serie de tarjetas con preguntas comunes, como "He perdido mi contrase√±a"
  (enlaza a `/recuperacion/password`). Indicador de tiempo restante durante uso.

### **C. P√°gina de Recuperaci√≥n de Contrase√±a (`/recuperacion/password`)**

- **Componente:** `WasmPasswordEngine.tsx`.
- **Interacci√≥n:** Formulario para introducir datos (ej. diccionarios), con niveles gratuito inicial
  (15 min) y pago por horas (descontando de `usageCreditsInSeconds`). Muestra progreso, contador
  tiempo y resultados.

### **D. P√°gina de Gu√≠as de Seguridad (`/seguridad`)**

- **Componente:** `SecurityGuides.tsx`.
- **Interacci√≥n:** Lista filtrada del blog por categor√≠a "seguridad".

### **E. P√°gina de Rastreador de Transacciones (`/herramientas/tracker`)**

- **Componente:** `TransactionTracker.tsx`.
- **Interacci√≥n:** Formulario para introducir hash de transacci√≥n o direcci√≥n, muestra resultados
  detallados de APIs externas. Contador tiempo durante uso.

### **F. P√°gina de Directorio de Servicios (`/herramientas/servicios`)**

- **Componente:** `ServiceDirectory.tsx`.
- **Interacci√≥n:** Lista de servicios profesionales con filtros por especialidad.

### **G. P√°ginas Legales (`/legal/*`)**

_Estas p√°ginas son fundamentales y deben estar perfectamente redactadas._

1.  **Aviso Legal, Privacidad, T√©rminos y Condiciones:** P√°ginas de texto est√°tico con el contenido
    legal correspondiente.
2.  **Descargo de Responsabilidad (`/legal/descargo-responsabilidad`):**
    - **Contenido:** Esta p√°gina contendr√° un texto **enorme y muy claro** explicando que Br√∫jula
      Cripto es una herramienta de software, que no garantiza la recuperaci√≥n, que no es un servicio
      de custodia, que no ofrece consejo financiero y que el uso de las herramientas es bajo la
      propia responsabilidad del usuario. Adaptado para modelo de pago por horas: "El tiempo
      comprado desbloquea uso temporal sin garant√≠a de √©xito".
    - **Visibilidad:** El enlace a esta p√°gina estar√° en el footer y en cualquier lugar donde se
      ofrezca un servicio de pago o de riesgo.

### **H. P√°gina de Contacto (`/contacto`)**

- **Componente:** `ContactForm.tsx`.
- **Interacci√≥n:** Formulario para enviar nombre, email y mensaje, que se procesa a trav√©s de una
  Cloud Function.

### **I. P√°gina del Blog (`/blog`)**

- **Componente Principal:** `BlogPage.tsx`
- **Estructura:** Banner superior editable desde admin (foto, texto H1/H2, descripci√≥n). Barra de
  b√∫squeda para t√≠tulos/tags/categor√≠as. Lista paginada de tarjetas con sharing nativo,
  likes/comentarios solo para usuarios con cr√©ditos (descontando tiempo). Categor√≠as/tags din√°micos
  editables/creables desde admin. Comentarios moderados auto/manual.

### **J. P√°gina de Art√≠culo (`/blog/[slug]`)**

- **Componente:** `ArticlePage.tsx`
- **Estructura:** Contenido f√°cil de leer, tags clicables, flechas para navegaci√≥n, sharing nativo,
  likes/comentarios para usuarios con cr√©ditos. Formulario comentarios con moderaci√≥n IA.

### **K. P√°gina del Chatbot (`/chatbot`)**

- **Componente:** `ChatbotUI.tsx`
- **Estructura:** Interfaz espectacular con imagen de br√∫jula como logo, nombre "Br√∫jula".
  Conversaciones listadas, respuestas streaming, sugerencias, render components (tablas/tarjetas).
  Contador tiempo (30 min inicial gratuito, luego pago por horas).

### **L. P√°gina de Planes por Hora (`/suscripcion`)**

- **Componente Principal:** `PricingPage.tsx`
- **Interacci√≥n:** Tabla de paquetes de horas (ej. 1h=5.99‚Ç¨, 5h=19.99‚Ç¨), secci√≥n interactiva de
  diferencias con calculadora para demostrar valor (inputs monto/horas, compara 20% competencia vs
  tarifas escalonadas: 4.99‚Ç¨/h primeras 2h, 3.99‚Ç¨/h resto). Muestra cr√©ditos iniciales gratuitos y
  tiempo restante si registrado.

---

## 3\. Flujo de Pago y Consentimiento (Monetizaci√≥n)

_La legalidad y la claridad en el pago son innegociables._

1.  **Oferta:** En p√°ginas de herramientas/chatbot, junto al uso gratuito inicial, mostrar oferta de
    paquetes de horas (`PricingTier.tsx`).
2.  **Consentimiento Expl√≠cito:** Junto al bot√≥n de compra (`UpgradeButton.tsx`), casilla
    obligatoria:
    > `‚òê He le√≠do y acepto los [T√©rminos y Condiciones](/legal/terminos) y entiendo el [Descargo de Responsabilidad](/legal/descargo-responsabilidad), reconociendo que la compra de horas desbloquea uso temporal de software sin garant√≠a de √©xito.`
3.  **Proceso:** Bot√≥n solo activado con casilla marcada; integra Stripe para compra √∫nica, suma
    cr√©ditos.
4.  **Visibilidad:** Enlace descargo visible durante compra y uso.

---

## 4\. P√°ginas de Administraci√≥n (`/admin/*`)

- **Acceso:** Protegido por una p√°gina de login (`/admin/auth`).
- **Dashboard (`/admin`):** Vista general de √∫ltimos art√≠culos, borradores, estad√≠sticas, usuarios y
  saldos cr√©ditos.
- **Gesti√≥n de Art√≠culos (`/admin/articles`):**
  - Tabla (`ArticleDataTable.tsx`) para ver/filtrar/editar/eliminar art√≠culos. Bot√≥n crear nuevo con
    editor avanzado: TipTap para texto, selector palabras (800/1200/1600), opci√≥n Q\&A/conclusiones,
    profundidad. Prompt IA texto (Gemini), prompt DALL-E imagen (OpenAI API, subir a Storage).
    Subida manual imagen. Programaci√≥n: Inmediata/manual/autom√°tica. CRUD categor√≠as/tags.
  - **Moderaci√≥n comentarios:** Tabla para aprobar/eliminar, con flags IA.
- **Editor de Art√≠culos (`/admin/articles/[id]`):**
  - Editor TipTap para modificar, estado (Borrador/Publicado/Programado), afiliados, portada
    (IA/manual).
- **Gesti√≥n de Contenido de la Home:** Secci√≥n para editar banner (fondo/overlay, textos es/en,
  bot√≥n).
- **Gesti√≥n de Feedback (`/admin/feedback`):** **NUEVO** Tabla mensajes, leer/eliminar
  individual/masivo.
- **Gesti√≥n de Usuarios (`/admin/users`):** **NUEVO** Tabla usuarios, saldos tiempo, historial
  compras. Formulario actualizar precios horas/paquetes.

## 5\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### **A. Pruebas de Usabilidad del RecoveryWizard**

- **Descripci√≥n:** En p√°gina `/recuperacion`, integrar pruebas A/B: Usar Vercel o Optimizely para
  variar texto/orden de tarjetas en `RecoveryWizard.tsx`, midiendo conversi√≥n a herramientas.
  Registrar m√©tricas en Firestore para an√°lisis.

### **B. Dise√±o Discreto para Saturaci√≥n de Enlaces Legales**

- **Descripci√≥n:** En `Footer.tsx`, para m√≥vil, implementar acorde√≥n con Tailwind para colapsar
  enlaces legales (Columna 2), expandible con click. Mantener visibilidad pero reducir sobrecarga
  visual.

### **C. Contador Tiempo en UX**

- **Descripci√≥n:** En todas las herramientas y chatbot, contador visible HH:MM:SS actualizado
  real-time v√≠a `trackUsage`. Al 0, upsell suave a `/suscripcion` con calculadora.

---

# üó∫Ô∏è PROYEC_PARTE6.MD - Plano de Experiencia de Usuario y Navegaci√≥n

## 1\. Navegaci√≥n Global y P√°ginas P√∫blicas

### **A. Estructura de Navegaci√≥n**

- **Header Adaptativo:** Cambia seg√∫n estado de autenticaci√≥n del usuario
- **Footer Consistente:** Enlaces legales y contacto en todas las p√°ginas
- **Breadcrumbs:** Navegaci√≥n jer√°rquica en p√°ginas internas

### **B. Estados de Navegaci√≥n**

#### **Usuario NO Autenticado**

```
[Logo] [Blog] [Herramientas] [Chatbot] [Contacto] [Registro] [Login]
```

#### **Usuario Autenticado**

```
[Logo] [Blog] [Herramientas] [Chatbot] [Contacto] [Avatar ‚ñº] (Tiempo Restante: HH:MM:SS)
                                        ‚îú‚îÄ Mi Cuenta (/cuenta)
                                        ‚îî‚îÄ Cerrar Sesi√≥n
```

## 2\. P√°ginas P√∫blicas (√Årea `(main)/`)

### **A. P√°ginas de Contenido**

1.  **Inicio (`/`)** - HomepageBanner (editable admin) + FeaturedPostsCarousel
2.  **Blog (`/blog`)** - Lista con b√∫squeda y paginaci√≥n, comentarios moderados
3.  **Art√≠culo (`/blog/[slug]`)** - Vista individual, comentarios con IA mod
4.  **Contacto (`/contacto`)** - Formulario de contacto

### **B. Herramientas P√∫blicas**

1.  **Recuperaci√≥n (`/recuperacion`)** - RecoveryWizard (diagn√≥stico, tiempo inicial 15 min)
2.  **Motor WASM (`/recuperacion/password`)** - WasmPasswordEngine (contador tiempo)
3.  **Seguridad (`/seguridad`)** - Blog filtrado por categor√≠a
4.  **Tracker (`/herramientas/tracker`)** - TransactionTracker (tiempo activo)
5.  **Servicios (`/herramientas/servicios`)** - ServiceDirectory

### **C. P√°ginas Legales (`/legal/`)**

1.  **Aviso Legal (`/legal/aviso-legal`)**
2.  **Privacidad (`/legal/privacidad`)**
3.  **T√©rminos (`/legal/terminos`)**
4.  **Descargo (`/legal/descargo-responsabilidad`)** (adaptado a pago por horas)

## 3\. Cuentas de Usuario y Pago por Uso

### **A. P√°ginas de Autenticaci√≥n (`(main)/`)**

#### **A.1. Registro (`/registro`)**

- **Componente:** `SignUpForm.tsx`
- **Campos:** Email, Contrase√±a, Confirmar Contrase√±a
- **Validaci√≥n:** Checkbox obligatorio para Pol√≠tica de Privacidad y T√©rminos
- **Post-registro:** Asignar cr√©ditos iniciales (15 min herramientas + 30 min chatbot), redirecci√≥n
  a `/cuenta`
- **Enlaces:** "¬øYa tienes cuenta? Inicia sesi√≥n"

#### **A.2. Inicio de Sesi√≥n (`/login`)**

- **Componente:** `SignInForm.tsx`
- **Opciones:**
  - Email y Contrase√±a
  - Bot√≥n "Iniciar sesi√≥n con Google"
- **Enlaces:**
  - "¬øOlvidaste tu contrase√±a?" ‚Üí `/recuperar-password`
  - "¬øNo tienes cuenta? Reg√≠strate" ‚Üí `/registro`

#### **A.3. Recuperaci√≥n de Contrase√±a (`/recuperar-password`)**

- **Componente:** `PasswordResetForm.tsx`
- **Flujo:**
  1.  Usuario introduce email
  2.  Firebase Authentication env√≠a correo autom√°tico
  3.  Usuario recibe enlace seguro para restablecer
- **Mensaje de confirmaci√≥n:** "Revisa tu correo electr√≥nico"

### **B. P√°gina de Planes por Hora (`/suscripcion`)**

#### **B.1. Estructura de Precios**

- **Componente:** `PricingPage.tsx`
- **Estructura:** Columnas para paquetes (Gratuito Inicial vs Paquetes Pagados)
- **Nivel Gratuito Inicial:** 15 min herramientas + 30 min chatbot (`usageCreditsInSeconds` inicial)
- **Paquetes Pagados:** Beneficios por horas compradas (descontando tiempo activo):
  - Ej. 1h por 5.99‚Ç¨, 5h por 19.99‚Ç¨
  - Tarifas: Primeras 2h 4.99‚Ç¨/h, resto 3.99‚Ç¨/h (calculadora muestra)
  - Soporte prioritario durante uso pagado
- **CTA:** Bot√≥n "Comprar Paquete" ‚Üí integraci√≥n Stripe (compra √∫nica)

#### **B.1.1. Calculadora Interactiva**

- **Inputs:** "Monto a recuperar (‚Ç¨)", "Horas estimadas"
- **Output:** Coste competencia (20% monto) vs Nuestro (tarifas escalonadas), ahorros num√©ricos
- **Enfatiza:** Privacidad local, ecosistema completo, inicio r√°pido, control real-time

### **B.2. P√°gina de Error 404 (`not-found.tsx`)**

- **Componente:** `NotFoundPage.tsx`
- **Estructura:** Imagen amigable (br√∫jula perdida), H1 ("P√°gina No Encontrada"), descripci√≥n ("Lo
  sentimos, la p√°gina que buscas no existe").

## 4\. Flujos de Usuario Cr√≠ticos

### **A. Flujo de Registro Completo**

1.  **Descubrimiento:** Usuario llega desde herramientas ‚Üí ve l√≠mite gratuito
2.  **Conversi√≥n:** Click "Comprar Tiempo" ‚Üí `/suscripcion`
3.  **Decisi√≥n:** Calculadora compara costos ‚Üí Selecciona paquete
4.  **Autenticaci√≥n:** Si no registrado, redir a `/registro` ‚Üí formulario
5.  **Pago:** Post-registro/login ‚Üí checkout Stripe (suma cr√©ditos)
6.  **Activaci√≥n:** Webhook suma `usageCreditsInSeconds`
7.  **Bienvenida:** Redirecci√≥n a `/cuenta` con tiempo restante

### **B. Flujo de Login Existente**

1.  **Acceso:** Usuario intenta herramienta sin cr√©ditos suficientes
2.  **Redirecci√≥n:** Middleware ‚Üí `/login` si no auth
3.  **Autenticaci√≥n:** Email/contrase√±a o Google OAuth
4.  **Redirecci√≥n:** Post-login ‚Üí herramienta o `/cuenta` (muestra tiempo)

### **C. Flujo de Gesti√≥n de Cr√©ditos**

1.  **Acceso:** Usuario en `/cuenta` ‚Üí secci√≥n "Mis Cr√©ditos" (tiempo restante HH:MM:SS, historial
    compras)
2.  **Compra:** Click "Comprar M√°s Tiempo" ‚Üí Portal Stripe para paquetes
3.  **Gesti√≥n:** Compra √∫nica en portal (no recurrente)
4.  **Webhook:** Stripe notifica ‚Üí suma cr√©ditos en Firestore
5.  **Reflejo:** Actualizaci√≥n real-time en UI v√≠a listener

### **D. Flujo de Uso Activo**

1.  **Inicio Uso:** En herramienta/chatbot, init `trackUsage` (descuenta cada seg activo)
2.  **Pausa:** Al inactividad \>30s, pausa contador
3.  **Agotado:** Al 0, modal upsell a `/suscripcion`
4.  **Consentimiento:** Checkbox descargo antes de compra/uso pagado

## 5\. Adaptaciones de Navegaci√≥n

### **A. Responsive Design**

- **Mobile:** Men√∫ hamburguesa colapsible
- **Tablet:** Navegaci√≥n horizontal compacta
- **Desktop:** Navegaci√≥n completa expandida

### **B. Estados de Loading**

- **Autenticaci√≥n:** Spinner durante verificaci√≥n de estado
- **Stripe checkout:** Loading durante redirecci√≥n
- **Formularios:** Estados de env√≠o con feedback
- **Contador Tiempo:** Real-time sync con backend

### **C. Manejo de Errores**

- **Autenticaci√≥n fallida:** Mensajes claros de error
- **Stripe error:** Redirecci√≥n con mensaje
- **Cr√©ditos insuficientes:** Mensaje "Tiempo agotado, compra m√°s en `/suscripcion`"
- **Conexi√≥n perdida:** Notificaci√≥n de reconexi√≥n

## 6\. Integraci√≥n con Documentaci√≥n Existente

### **A. Actualizaci√≥n PROYEC_PARTE2.MD (Frontend)**

- ‚úÖ Rutas actualizadas: `/(main)/suscripcion` para planes por hora
- ‚úÖ Componentes: `PricingPage` con calculadora escalonada, `UserDashboard` con contador/historial
- ‚úÖ Navegaci√≥n: Indicador tiempo en header para auth

### **B. Actualizaci√≥n PROYEC_PARTE3.MD (Backend)**

- ‚úÖ Modelo `users` con `usageCreditsInSeconds`, `purchaseHistory`
- ‚úÖ Cloud Function: `trackUsage.ts` para descuento real-time
- ‚úÖ Webhook Stripe para compras √∫nicas (suma cr√©ditos)
- ‚úÖ Reglas seguridad para updates at√≥micos de cr√©ditos

### **C. Middleware de Protecci√≥n**

- **Archivo:** `middleware.ts` (Next.js)
- **Rutas protegidas:** `/(dashboard)/*`
- **Comportamiento:** Redirecci√≥n autom√°tica a `/login` si no autenticado; check cr√©ditos para
  herramientas

## 7\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### **A. Tarifas Espec√≠ficas en Pago por Hora**

- **Descripci√≥n:** En B.1, definir tarifas: Primeras 2h 4.99‚Ç¨/h, siguientes 3.99‚Ç¨/h. Paquetes:
  1h=5.99‚Ç¨, 5h=19.99‚Ç¨ (pago √∫nico). Actualizar en `PricingPage.tsx` con variables de Firestore para
  flexibilidad admin.

### **B. Especificaci√≥n de Soporte Prioritario**

- **Descripci√≥n:** Durante uso pagado, SLA \<24h v√≠a email dedicado. En `/cuenta`, bot√≥n "Soporte"
  si tiempo \>0.

### **C. Retenci√≥n de Usuarios**

- **Descripci√≥n:** Post-compra, emails Mailgun con tips y recordatorio cr√©ditos. Trigger en webhook
  para notificaciones de bajo saldo.

### **D. Valor Diferencial en Planes**

- **Descripci√≥n:** En `/suscripcion`, enfatizar: Privacidad (local vs servidores), ecosistema
  (completo vs limitado), facilidad (r√°pido vs tr√°mites), control (real-time vs caja negra).
  Calculadora demuestra ahorros con tarifas escalonadas.

---

# ü§ñ PROYEC_PARTE7.MD: Br√∫jula Cripto - Plan de Arquitectura - Miniservicio de Chatbot Cripto-Especialista (V2)

## 1\. Visi√≥n General y Prop√≥sito

Este documento detalla la arquitectura de un miniservicio completamente independiente y robusto que
alojar√° a un chatbot especialista en criptomonedas. El servicio funcionar√° bajo un modelo Freemium
(cr√©ditos iniciales 30 min gratuitos) y pago por horas, integr√°ndose con la plataforma principal de
Br√∫jula Cripto.

**Principios Clave:**

- **Aislamiento:** El servicio se ejecuta de forma independiente para no afectar al rendimiento de
  la aplicaci√≥n principal.
- **Escalabilidad:** Construido sobre infraestructura serverless para manejar cualquier nivel de
  carga.
- **Inteligencia Real:** El chatbot no solo responde, sino que "aprende" a trav√©s de RAG
  (Retrieval-Augmented Generation) y puede interactuar con datos de la blockchain en tiempo real.
- **Pago por Uso:** Descuenta de `usageCreditsInSeconds` durante conversaciones activas (via
  `trackUsage`).

## 2\. Arquitectura T√©cnica Detallada

El servicio se construir√° sobre Google Cloud, manteniendo la coherencia con el resto del ecosistema.

- **Hosting del Servicio:** Google Cloud Run.
- **Orquestaci√≥n de IA:** Genkit for Firebase.
- **Modelo de Lenguaje (LLM):** Google Gemini Pro.
- **Base de Datos de Conversaciones:** Cloud Firestore.
- **Base de Conocimiento ("Aprendizaje"):** Vertex AI Vector Search. Aqu√≠ es donde el chatbot
  "aprende", indexando documentaci√≥n t√©cnica, whitepapers y gu√≠as de seguridad para dar respuestas
  expertas (RAG).
- **Conexi√≥n a la Blockchain (Herramientas):** El chatbot usar√° "Tools" de Genkit para interactuar
  con APIs externas (ej. Covalent, Moralis, GoPlus Security). Las herramientas ser√°n:
  - `getWalletAnalysis(address, chain)`: Devuelve el balance, tokens, NFTs y un an√°lisis de riesgos
    (solo si cr√©ditos \>0).
  - `getTransactionStatus(txHash, chain)`: Verifica el estado de una transacci√≥n.
  - `getContractAuditSummary(contractAddress, chain)`: Obtiene un resumen de la seguridad de un
    contrato.

## 3\. Modelo de Datos en Firestore (Dedicado al Chatbot)

**Colecci√≥n `chatbot_conversations`:**

- **Campos:** `userId`, `title`, `isFavorite`, `createdAt`, `updatedAt`, `creditsUsed` (number) -
  **NUEVO** Segundos descontados.

**Sub-colecci√≥n `chatbot_messages`:**

- Anidada dentro de cada conversaci√≥n.
- **Campos:** `role` ('user' | 'model'), `content`, `timestamp`.

## 4\. Funcionalidades de Usuario y Flujo de Interacci√≥n

El frontend (`packages/app`) tendr√° una nueva secci√≥n para el chatbot que interactuar√° con el
miniservicio a trav√©s de una API REST.

- **Endpoints de la API:** `GET /conversations`, `POST /conversations`, `PUT /conversations/{id}`,
  `DELETE /conversations/{id}`, `POST /conversations/{id}/messages` (con streaming, check cr√©ditos
  via `trackUsage`).
- **Panel de Usuario del Chatbot:** Una barra lateral con la lista de conversaciones (crear,
  renombrar, favorito, borrar) y la ventana de chat principal. Contador tiempo restante visible.

## 5\. Modelo de Monetizaci√≥n y Propuesta de Valor

Reemplazado por pago por horas: Cr√©ditos iniciales 30 min gratuitos para enganchar.

### A. El Valor para el Usuario Gratuito Inicial (El Anzuelo üé£)

El usuario registrado obtiene 30 min gratuitos para consultas generales. Cuando pide an√°lisis
wallet, ofrece demo limitada si cr√©ditos bajos. **Respuesta Gratuita:** "He identificado que la
direcci√≥n 0x123... es una wallet v√°lida en Ethereum. Para an√°lisis completo, necesitas m√°s tiempo.
Tienes X min restantes o compra paquetes en `/suscripcion`."

### B. El Valor para el Usuario de Pago por Horas (La Soluci√≥n Completa üõ°Ô∏è)

Durante uso pagado (descontando segundos), entrega informes completos. **Respuesta Pagada:** "Claro.
Aqu√≠ tienes el an√°lisis de tu wallet:

- **Valor Total:** 1,250.45 ‚Ç¨
- **Activos:** 150.2 MATIC, 0.25 WETH, 500.10 USDC...
- **NFTs:** 2 de la colecci√≥n "CryptoPunks Polygon".
- üö® **¬°AN√ÅLISIS DE RIESGOS\!** üö® ¬°Atenci√≥n\! Aprobaci√≥n de Contrato de Riesgo: Tienes una
  aprobaci√≥n ilimitada para el contrato 0x789.... Este contrato podr√≠a retirar todos tus WETH. Se
  recomienda revocar este permiso inmediatamente."

El valor es la claridad financiera y seguridad proactiva, con descuento tiempo solo en interacciones
activas.

## 6\. Integraci√≥n con la Plataforma Existente

- **Frontend (`packages/app`):** Se crear√° una nueva ruta `/chatbot` con los componentes de la
  interfaz (`ChatbotUI.tsx`, `ConversationList.tsx`). El archivo `lib/api.ts` se ampliar√° para
  llamar a los endpoints del nuevo miniservicio, integrando `trackUsage` para cr√©ditos.
- **Backend (`packages/functions`):** Se a√±adir√°n las funciones de pago de Stripe para paquetes de
  horas, que suman al `usageCreditsInSeconds`. Integrar `trackUsage` en endpoints de chat.
- **Tipos (`packages/types`):** Se a√±adir√°n las nuevas interfaces: `IChatConversation` y
  `IChatMessage`, con `creditsUsed`.

## 7\. Experiencia de Usuario (UX) Espectacular

Para que sea el mejor chatbot del mundo, la experiencia debe ser impecable:

- **Respuestas en Streaming:** El chatbot escribir√° las respuestas palabra por palabra, como
  ChatGPT, dando una sensaci√≥n de "pensamiento" en tiempo real y mejorando la percepci√≥n de
  velocidad (descontando tiempo durante stream).
- **Sugerencias de Preguntas:** Al iniciar una nueva conversaci√≥n o despu√©s de una respuesta, el
  chatbot sugerir√° preguntas de seguimiento relevantes. Ej: "¬øQuieres que analice los riesgos de
  este contrato?", "¬øTe gustar√≠a saber m√°s sobre el token WETH?".
- **Renderizado de Componentes:** El chatbot no solo devolver√° texto. Cuando genere un informe de
  wallet, el frontend renderizar√° componentes visuales (tablas para tokens, tarjetas para NFTs)
  dentro del chat, haciendo la informaci√≥n mucho m√°s digerible.
- **Memoria a Corto y Largo Plazo:** El chatbot recordar√° el contexto de la conversaci√≥n actual.
  Adem√°s, a trav√©s de RAG, tendr√° acceso al conocimiento experto, simulando una memoria a largo
  plazo.
- **Claridad y Simplicidad:** Todas las respuestas, incluso las m√°s t√©cnicas, se explicar√°n en un
  lenguaje sencillo. El objetivo no es abrumar, sino empoderar al usuario.
- **Dise√±o Espectacular:** Imagen principal de br√∫jula como icono/logo, nombre del chatbot "Br√∫jula"
  visible en header de p√°gina. Contador tiempo en esquina.

## 8\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### A. L√≠mites de Uso para Chatbot Gratuito Inicial

**Descripci√≥n:** En endpoints API, implementar l√≠mites: Usuarios con cr√©ditos iniciales (30 min)
descontados via `trackUsage`. Si \<30s restantes, retornar error 429 con mensaje upsell a
`/suscripcion`. No altera flujos pagados; pausa en inactividad.

### B. Integraci√≥n con Pago por Horas

**Descripci√≥n:** Extender `trackUsage` para chat: Descontar solo durante respuestas
activas/streaming. Al agotar, "Tus 30 min iniciales se han usado. Compra m√°s tiempo para continuar."

---

# üíé TEXTOS_IMAGENES.MD: SEO, Copywriting y Activos Visuales (Producci√≥n V2)

### Pre√°mbulo

Este documento detalla el contenido textual (copy), las metaetiquetas SEO (t√≠tulo y descripci√≥n) y
las especificaciones para los activos visuales de todas las p√°ginas p√∫blicas de Br√∫jula Cripto. El
objetivo es crear una narrativa de marca fuerte, comunicar valor real y alcanzar la m√°xima
visibilidad en motores de b√∫squeda. Adaptado al modelo de pago por horas con cr√©ditos iniciales
gratuitos.

---

## **1. P√ÅGINA DE INICIO (`/`)**

_Objetivo: Captar la atenci√≥n en 3 segundos, establecer confianza y guiar al usuario hacia las
herramientas clave, destacando cr√©ditos gratuitos iniciales._

### **Metaetiquetas SEO**

- **Espa√±ol:**
  - `title`: Br√∫jula Cripto | Seguridad y Recuperaci√≥n de Criptomonedas
  - `description`: Tu gu√≠a experta para proteger, gestionar y recuperar tus criptoactivos. Prueba
    gratis 15 min en herramientas + 30 min en chatbot. Herramientas reales para tranquilidad.
- **Ingl√©s:**
  - `title`: Crypto Compass | Cryptocurrency Security & Recovery
  - `description`: Your expert guide to protect, manage, and recover your crypto assets. Free trial:
    15 min tools + 30 min chatbot. Real tools for peace of mind.

### **Secci√≥n 1: Banner Principal (`HomepageBanner.tsx`)**

- **Imagen de Fondo:**
  - **Ruta:** `/public/images/home/banner-hero.webp`
  - **Tama√±o:** 1920x1080px (16:9)
  - **Prompt para generar imagen:** "Abstract, elegant digital vault with a glowing blue compass
    needle floating in the center, dark background, cinematic lighting, sophisticated, secure, tech
    aesthetic."
- **Overlay Image (Opcional, editable admin):**
  - **Ruta:** `/public/images/home/overlay-compass.webp`
  - **Prompt:** "Glowing compass overlay on digital background, transparent PNG."
- **Contenido (ES):**
  - **T√≠tulo (H1):** `Navega el Mundo Cripto con Confianza.`
  - **Subt√≠tulo:**
    `Prueba gratis 15 min en recuperaci√≥n y 30 min en chatbot. Compra horas extras a tarifas bajas para protecci√≥n total.`
  - **Bot√≥n:** `Empezar Diagn√≥stico Gratis` (enlaza a `/recuperacion`)
- **Contenido (EN):**
  - **Title (H1):** `Maps the Crypto World with Confidence.`
  - **Subtitle:**
    `Free trial 15 min recovery + 30 min chatbot. Buy extra hours at low rates for full protection.`
  - **Button:** `Start Free Diagnosis` (links to `/en/recovery`)

### **Secci√≥n 2: Propuesta de Valor (`ValueProposition.tsx`)**

_Una secci√≥n limpia con 3 iconos y texto breve._

- **T√≠tulo (ES):** `Tu Escudo en el Ecosistema Digital`
- **T√≠tulo (EN):** `Your Shield in the Digital Ecosystem`
- **Columna 1:**
  - **Icono:** Un escudo (`shield-check-icon.svg`)
  - **T√≠tulo (ES):** `Protecci√≥n Proactiva`
  - **Texto (ES):**
    `Analiza riesgos con tus cr√©ditos iniciales gratuitos. Compra horas para an√°lisis ilimitados.`
- **Columna 2:**
  - **Icono:** Una llave inglesa (`wrench-icon.svg`)
  - **T√≠tulo (ES):** `Herramientas Reales`
  - **Texto (ES):**
    `Desde recuperaci√≥n de contrase√±as (15 min gratis) hasta rastreo pagado por horas.`
- **Columna 3:**
  - **Icono:** Una br√∫jula (`compass-icon.svg`)
  - **T√≠tulo (ES):** `Gu√≠a Experta`
  - **Texto (ES):** `Chatbot con 30 min gratis, luego por horas para seguridad experta.`

### **Secci√≥n 3: Carrusel de Posts Destacados (`FeaturedPostsCarousel.tsx`)**

- **Imagen de Fondo (opcional):** Ninguna, para mantener foco en tarjetas.
- **Contenido:** Muestra 4-5 posts recientes del blog con tarjetas (`ArticleCard.tsx`), cada una con
  imagen de portada (IA o manual), t√≠tulo, excerpt y enlace al art√≠culo completo.
- **Interacci√≥n:** Carrusel deslizable con controles de flechas, auto-scroll opcional desactivado
  por defecto.

### **Secci√≥n 4: Bot√≥n de Feedback (`FeedbackButton.tsx`)**

- **Ubicaci√≥n:** Flotante en esquina inferior derecha de la homepage, visible solo para usuarios
  registrados.
- **Interacci√≥n:** Al click, abre modal para enviar mensaje de feedback (reconociendo al usuario v√≠a
  `uid`, sin descontar tiempo). Admin gestiona en panel (leer/eliminar).

---

## **2. P√ÅGINA DE DIAGN√ìSTICO Y RECUPERACI√ìN (`/recuperacion`)**

_Objetivo: Guiar al usuario en p√°nico con empat√≠a y claridad, sin promesas falsas, destacando 15 min
gratuitos._

### **Metaetiquetas SEO**

- **Espa√±ol:**
  - `title`: Diagn√≥stico y Recuperaci√≥n de Criptomonedas | Br√∫jula Cripto
  - `description`: Recupera acceso a wallets con 15 min gratis. Compra horas extras si necesitas
    m√°s. Gu√≠a paso a paso segura.
- **Ingl√©s:**
  - `title`: Cryptocurrency Diagnosis & Recovery | Crypto Compass
  - `description`: Recover wallet access with 15 min free. Buy extra hours if needed. Safe
    step-by-step guide.

### **Secci√≥n 1: Banner de Diagn√≥stico (`DiagnosisBanner.tsx`)**

- **Imagen de Fondo:**
  - **Ruta:** `/public/images/recovery/banner-diagnosis.webp`
  - **Tama√±o:** 1920x600px
  - **Prompt para generar imagen:** "Calm, reassuring scene of a digital compass pointing to a
    locked vault opening, soft blue tones, motivational tech vibe."
- **Contenido (ES):**
  - **T√≠tulo (H1):** `Tranquilo, Estamos Aqu√≠ para Ayudarte.`
  - **Subt√≠tulo:**
    `Usa tus 15 min gratuitos para diagn√≥stico. Si necesitas m√°s, compra horas asequibles.`
- **Contenido (EN):**
  - **Title (H1):** `Stay Calm, We're Here to Help.`
  - **Subtitle:** `Use your 15 min free for diagnosis. Buy affordable hours if you need more.`

### **Secci√≥n 2: Diagn√≥stico Interactivo (`RecoveryWizard.tsx`)**

- **Estructura:** Una serie de tarjetas clicables con preguntas comunes.
- **Tarjeta 1 (ES):** `He perdido mi contrase√±a o seed phrase` (enlaza a `/recuperacion/password`,
  nota: 15 min gratis).
- **Tarjeta 2 (ES):** `Necesito ayuda con la seguridad de mi wallet` (enlaza a `/seguridad`).
- **Tarjeta 3 (ES):** `Quiero un servicio profesional` (enlaza a `/herramientas/servicios`).
- **Tarjeta 4 (ES):** `Necesito rastrear una transacci√≥n` (enlaza a `/herramientas/tracker`, tiempo
  pagado).

---

## **3. P√ÅGINA DE PLANES POR HORA (`/suscripcion`)**

_Objetivo: Comunicar el valor del pago por horas, con calculadora escalonada y cr√©ditos iniciales,
demostrando superioridad num√©rica sobre competidores._

### **Metaetiquetas SEO**

- **Espa√±ol:**
  - `title`: Planes por Hora y Cr√©ditos | Br√∫jula Cripto
  - `description`: Compra horas a 4.99‚Ç¨ primeras 2h, 3.99‚Ç¨ resto. Prueba gratis 15+30 min. Protege
    activos con an√°lisis real-time, mejor que 20% de competidores.
- **Ingl√©s:**
  - `title`: Hourly Plans & Credits | Crypto Compass
  - `description`: Buy hours at 4.99‚Ç¨ first 2h, 3.99‚Ç¨ after. Free trial 15+30 min. Protect assets
    with real-time analysis, better than competitors' 20%.\`

### **Secci√≥n 1: Cabecera**

- **Contenido (ES):**
  - **T√≠tulo (H1):** `Invierte en Horas de Tranquilidad.`
  - **Subt√≠tulo:**
    `Empieza con 15 min gratis en herramientas y 30 min en chatbot. Compra paquetes de horas para protecci√≥n ilimitada‚Äîtarifas escalonadas m√°s bajas que el 20% de competidores, con privacidad total y control real-time.`
- **Contenido (EN):**
  - **Title (H1):** `Invest in Hours of Peace of Mind.`
  - **Subtitle:**
    `Start with 15 min free tools + 30 min chatbot. Buy hour packages for unlimited protection‚Äîtiered rates lower than competitors' 20%, with total privacy and real-time control.`

### **Secci√≥n 2: Tabla de Planes (`PricingPage.tsx`)**

_Columnas lado a lado, destacando paquetes pagados._

- **Columna 1: Gratuito Inicial**
  - **Precio (ES/EN):** `0‚Ç¨ / 15+30 min` | `$0 / 15+30 min`
  - **Caracter√≠sticas:** `Diagn√≥stico Interactivo (15 min)`, `Blog y Gu√≠as`,
    `Recuperaci√≥n Limitada (15 min)`, `Chatbot (30 min)`.
- **Columna 2: Paquetes Pagados (borde resaltado)**
  - **Paquetes Ejemplos:** `1h: 5.99‚Ç¨`, `5h: 19.99‚Ç¨` (tarifas: 4.99‚Ç¨/h x2 + 3.99‚Ç¨/h resto)
  - **Bot√≥n (ES/EN):** `Comprar Paquete` | `Buy Package`
  - **Caracter√≠sticas:**
    - `‚úÖ Todo inicial, m√°s horas ilimitadas:`
    - `üöÄ **Potencia Completa** en Recuperaci√≥n`
    - `ü§ñ **Chatbot Extendido** con An√°lisis Wallet`
    - `üõ°Ô∏è **Riesgos Seguridad Real-Time**`
    - `üìà **Rastreo Avanzado**`
    - `‚≠ê **Soporte Prioritario** durante uso`

### **Secci√≥n 3: Descargo de Responsabilidad del Pago**

_Texto legal claro debajo de tabla._

- **Contenido (ES):**
  `Al comprar horas, aceptas [T√©rminos](/legal/terminos) y [Descargo](/legal/descargo-responsabilidad). Desbloquea tiempo de uso sin garant√≠a de √©xito.`
- **Contenido (EN):**
  `By buying hours, you agree to [Terms](/en/legal/terms) and [Disclaimer](/en/legal/disclaimer). Unlocks usage time with no success guarantee.`

### **Secci√≥n 4: Diferencias Interactivas con Competidores (`CompetitorComparison.tsx`)**

- **Estructura:** Tabs (privacidad, ecosistema, facilidad, precios). Calculadora: Inputs "Monto
  (‚Ç¨)", "Horas". Calcula competencia (20% monto) vs nuestro ((2\*4.99) + (horas-2)\*3.99 si \>2),
  ahorros: "Para 500‚Ç¨ y 5h, pagas 100‚Ç¨ competencia vs 18.95‚Ç¨ con nosotros‚Äîahorras 81.05‚Ç¨ con
  privacidad absoluta."

## 4\. Mejoras Implementadas para Robustez y Producci√≥n 2025

### **A. Optimizaci√≥n de Im√°genes para SEO**

- **Descripci√≥n:** En todas las im√°genes (ej. `banner-hero.webp`), aplicar compresi√≥n autom√°tica con
  Sharp en build-time de Next.js, y soporte para AVIF via `next/image`. A√±adir en rutas:
  `format: 'avif'` para mejora de carga.

### **B. M√©tricas de Engagement**

- **Descripci√≥n:** Integrar Google Analytics en todas las p√°ginas: Usar `next/script` para cargar
  GA4, rastreando tasas de rebote, clics en CTAs y enlaces legales. Configurar eventos en botones
  como "Comprar Paquete".

### **C. Equilibrio Atractivo/Transparencia**

- **Descripci√≥n:** En Secci√≥n 3, implementar A/B testing para texto de descargo: Versi√≥n breve
  "Acepto t√©rminos sin garant√≠a" vs original. Usar Vercel para variants y medir conversi√≥n.

### **D. Textos para Calculadora**

- **Descripci√≥n:** En calculadora, copy: "Calcula tus ahorros: Competidores cobran 20% del monto
  recuperado. Nosotros: Horas fijas escalonadas, privacidad en navegador, ecosistema
  completo‚Äîempieza en minutos con control total."
