 PROYECTO: Br煤jula Cripto - Plan del Microservicio de Contenido IA (VERSIN FINAL DE PRODUCCIN)

1. Stack Tecnol贸gico

Framework: Genkit for Firebase (TypeScript)
Ejecuci贸n: Google Cloud Run (Contenedor Docker)
Modelo IA: Gemini Pro (v铆a Vertex AI)
Trigger: Google Cloud Scheduler

2. L贸gica y Centralizaci贸n

Prompts Centralizados: Los prompts para Gemini estar谩n en archivos .txt (/src/prompts) para ser mejorados sin tocar el c贸digo.
Tipos Compartidos: Importar谩 IArticle desde @br煤jula-cripto/types.
Validaci贸n Robusta: Se usar谩 Zod para validar la salida final del LLM.

3. Flujo de Ejecuci贸n Detallado - Actualizado para i18n

Trigger: Cloud Scheduler llama a la URL de Cloud Run.
fetch-news: El flujo ejecuta la herramienta newsApiTool. Manejo de Errores: Si falla, usa un tema "evergreen" de fallback.
generate-content-es: Carga el prompt, lo formatea para espa帽ol, y genera title, contentMarkdown, y excerpt en espa帽ol.
generate-content-en: Carga el prompt, lo formatea para ingl茅s, y genera title, contentMarkdown, y excerpt en ingl茅s.
generate-seo-metadata: Genera un slug 煤nico (independiente del idioma), category, y tags basados en el contenido de ambos idiomas.
check-slug-uniqueness: Consulta Firestore para asegurar que el slug no existe. Si existe, a帽ade un sufijo.
assemble-and-validate: Construye el objeto IArticle final con los contenidos de es y en y los metadatos. Valida el objeto completo con Zod.
save-to-firestore: Si la validaci贸n pasa, guarda el art铆culo completo en la base de datos con status: 'draft' y source: 'ai-generated'.
Logging: Cada paso registra su estado en Google Cloud Logging.

4. Seguridad y Configuraci贸n

Gesti贸n de Secretos: Las claves de Vertex AI se inyectar谩n de forma segura en el entorno de Cloud Run a trav茅s de Google Secret Manager.
Variables de Entorno: La configuraci贸n (Project ID, etc.) se pasar谩 al contenedor de Cloud Run en el momento del despliegue.

5. Mejoras Implementadas para Robustez y Producci贸n 2025
A. Optimizaci贸n de Carga en Vertex AI

Descripci贸n: En flujo de ejecuci贸n, a帽adir paso post-indexaci贸n: Optimizar 铆ndice en Vertex AI priorizando documentos de alta relevancia (basado en frecuencia de uso), con limpieza peri贸dica semanal via Scheduler. A帽adir en logging: Registro de tama帽o de 铆ndice para monitoreo.

B. Validaci贸n de Respuestas T茅cnicas

Descripci贸n: Despu茅s de assemble-and-validate, a帽adir paso audit-responses: Implementar auditor铆a automatizada usando Zod para precisi贸n t茅cnica, con fallback a revisi贸n manual si score <90%. Integrar en flujo sin alterar validaci贸n Zod existente.

C. Generaci贸n SEO Automatizada

Descripci贸n: En generate-seo-metadata, generar metaetiquetas din谩micas (title, description, keywords) enfocadas a SEO 2025 (usando schema.org, mobile-first indexing). Categor铆as/tags din谩micos, editables desde admin. Para posts autom谩ticos, opci贸n en admin para foto (s铆/no), enlace afiliado, programaci贸n de publicaci贸n.

D. Moderaci贸n Autom谩tica de Comentarios

Descripci贸n: Nuevo flujo moderateComment: Analiza comentarios nuevos con OpenAI Moderation o Google Perspective API. Marcar para revisi贸n o eliminar autom谩ticamente basado en config admin (almacenada en Firestore). Trigger por writes en subcolecci贸n comments.

E. Adaptaci贸n para Uso Externo

Descripci贸n: A帽adir endpoints API para embed en otras webs (ej. GET /articles?siteKey=xxx). Monetizar v铆a suscripciones API (verificar key en Firestore, limitar por quota). M铆nimos cambios: A帽adir param siteKey en queries, sin alterar flujos internos.
